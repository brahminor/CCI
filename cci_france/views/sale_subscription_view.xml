<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="view_sale_subscription_form" model="ir.ui.view">
        <field name="name">sale.subscription.form.inherit</field>
        <field name="model">sale.subscription</field>
        <field name="type">form</field>
        <field name="priority" eval="50"/>
        <field name="inherit_id" ref="sale_subscription.sale_subscription_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='code']" position="before">
                <field name="is_membership"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="replace">
                <field name="partner_id" required="1" string="Contact/Société"/>
                <!--<field name="company_id"/>-->
                <field name="company_type" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="attributes">
                <attribute name="string">Responsable</attribute>
            </xpath>
            <xpath expr="//div[@class='badge-pill badge-warning float-right']" position="after">
                <div class="badge-pill badge-warning float-right" 
                    attrs="{'invisible': [('is_membership', '=', False)]}">Adhésion</div>
            </xpath>
             <xpath expr="//notebook" position="inside">
                 <page string="Adhesion" attrs="{'invisible': [('is_membership','=', False)]}">
                     <group colspan="4">
                         <group>
                             <field name="individual_member" 
                                    attrs="{'readonly': [('company_type','=', 'company')]}"/>
                         </group>
                         <group>
                            <field name="membership_type_id"/>
                         </group>
                     </group>
                      <div>
                        <label for="all_members"/>
                        <field name="all_members" attrs="{'readonly': [('company_type','!=', 'company')]}"/>
                      </div>
                      <field name="contact_ids"
                            domain="[('parent_id', '=', partner_id)]"
                            attrs="{'readonly': [('company_type','!=', 'company')]}">
                            <tree editable="top">
                                <field name="display_name"/>
                                <field name="is_member"/>
                            </tree>
                     </field>
                 </page>
             </xpath>
        </field>
    </record>

    <record id="view_sale_subscription_tree" model="ir.ui.view">
        <field name="name">sale.subscription.tree.inherit</field>
        <field name="model">sale.subscription</field>
        <field name="type">tree</field>
        <field name="priority" eval="50"/>
        <field name="inherit_id" ref="sale_subscription.sale_subscription_view_list"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='to_renew']" position="after">
                <field name="is_membership" invisible="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_sale_subscription_view_kanban" model="ir.ui.view">
        <field name="name">sale.subscription.kanban.inherit</field>
        <field name="model">sale.subscription</field>
        <field name="priority" eval="50"/>
        <field name="inherit_id" ref="sale_subscription.sale_subscription_view_kanban"/>
        <field name="arch" type="xml"> 
            <xpath expr="//field[@name='to_renew']" position="after">
                <field name="is_membership"/>
            </xpath>
        </field>
    </record>

    <record id="view_sale_subscription_search" model="ir.ui.view">
        <field name="name">sale.subscription.search</field>
        <field name="model">sale.subscription</field>
        <field name="type">search</field>
        <field name="priority" eval="50"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='pending']" position="after">
                <filter name="is_membership" string="Adhesion"  
                    domain="[('is_membership', '=', True)]" />
            </xpath>
        </field>
    </record>

    <!-- Membership Type -->
        <record id="view_membership_type_tree" model="ir.ui.view">
            <field name="name">membership.type.tree</field>
            <field name="model">membership.type</field>
            <field name="type">tree</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <tree string="Type Adhesion">
                    <field name="name"/>
                </tree>
            </field>
        </record>
        
        <record id="view_membership_type_form" model="ir.ui.view">
            <field name="name">membership.type.form</field>
            <field name="model">membership.type</field>
            <field name="type">form</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <form string="Type Adhesion">
                    <sheet>
                        <group colspan="4">
                            <group>
                                <field name="name" select="1"/>
                            </group>
                            <group>
                                <field name="description"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        
        <record id="view_membership_type_search" model="ir.ui.view">
            <field name="name">membership.type.search</field>
            <field name="model">membership.type</field>
            <field name="type">search</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
                <search string="Type Adhesion">
                    <field name="name" select="True"/>
                </search>
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="act_open_membership_type_view">
            <field name="name">Type Adhesion</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">membership.type</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_membership_type_search"/>
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>
        
        <record model="ir.actions.act_window.view" id="act_open_membership_type_view_form">
            <field name="act_window_id" ref="act_open_membership_type_view"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_membership_type_form"/>
        </record>
        
        <record model="ir.actions.act_window.view" id="act_open_membership_type_view_tree">
            <field name="act_window_id" ref="act_open_membership_type_view"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_membership_type_tree"/>
        </record>
        
        <menuitem id="menu_membership_type"
            parent="membership.menu_marketing_config_association"
            sequence="20"
            action="act_open_membership_type_view"/>

    <!-- New action for membership menu-->
    <record id="sale_subscription_action_inherit" model="ir.actions.act_window">
        <field name="name">Adhesion</field>
        <field name="res_model">sale.subscription</field>
        <field name="view_mode">kanban,tree,form,pivot,graph,cohort,activity</field>
        <field name="context">{
            "search_default_my_subscriptions":1,
            "default_is_membership": 1,
        }</field>
        <field name="domain">[('is_membership', '=', True)]</field>
        <field name="search_view_id" ref="sale_subscription.sale_subscription_view_search"/>
    </record>

    <menuitem name="Gestion Adhesions" id="membership.menu_association"
        sequence="15" web_icon="cci_france,static/src/img/cci-logo.png"/>

    <menuitem id="menu_membership_membership_line"
        name="Adhésions"
        parent="membership.menu_association"
        sequence="20"
        action="sale_subscription_action_inherit"/>
</odoo>
